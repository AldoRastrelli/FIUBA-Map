function createFiubaMap(t,a,e){$.ajax({url:a,dataType:"text",success:function(a){new FiubaMap(a,e,t)}})}function FiubaMap(t,a,e){let i;FIUBAMAP=this,this.carrera=e,[this.MATERIAS,i,this.GRUPOS,this.MATERIAS_CRED]=csvANodosyAristas(t),this.NETWORK=crearNetwork(this.MATERIAS,i),this.resetBindings=function(){const t=this;$(".toggle").off("click").on("click",function(){let[,a]=$(this).attr("id").split("-");new Grupo(a).openOrClose(),t.NETWORK.fit()}),t.NETWORK.off("click").on("click",function(a){if(!a.event.isFinal)return;let e=a.nodes[0];if(!e)return;let i=t.MATERIAS.get(e),o=i.aprobada;o?t.MATERIAS.get(e).desaprobar():(PARTYMODE&&partyMode(i),t.MATERIAS.get(e).aprobar()),t.chequearNodosCRED()}),t.NETWORK.off("hold").on("hold",function(a){let e=a.nodes[0];e&&t.MATERIAS.get(e).mostrarOpciones()})},this.actualizarPromedio=function(t){0===t.nota?delete this.aprobadasConNota[t.id]:this.aprobadasConNota[t.id]=parseInt(t.nota);let a=Object.values(this.aprobadasConNota).reduce((t,a)=>t+a,0),e=Object.values(this.aprobadasConNota).length,i=(a/e).toFixed(2);isNaN(i)?$("#promedio-var").text("-"):$("#promedio-var").text(i)},this.actualizarCreditos=function(t){this.creditos+=t,$("#creditos-var").text(this.creditos)},this.chequearNodosCRED=function(){this.MATERIAS_CRED.forEach(t=>{this.creditos<t.requiere?this.MATERIAS.get(t.id).deshabilitar():this.creditos>=t.requiere&&this.MATERIAS.get(t.id).habilitar()})},this.creditos=0,this.aprobadasConNota={},$("#creditos-var").text(0),$("#promedio-var").text("-"),a?aprobarMateriasFromLoad(a):this.MATERIAS.get("CBC").aprobar(),this.GRUPOS.forEach(t=>{crearGrupo(t)}),this.resetBindings()}function csvANodosyAristas(t){let a=[],e=[],i=[],o=[],n=t.split(/\r?\n|\r/);for(let t=1;t<n.length;t++){let r=n[t].split(","),[s,c,l,d,u,h]=r,p=new Materia(s,c,l,d,u,h);p.correlativas.forEach(t=>{if(t.includes("CRED")){let[,a]=t.split("CRED");p.requiere=a,o.push(p)}let a={from:t,to:p.id};"CBC"==t&&p.requiere&&(a.hidden=!0),e.push(a)}),a.push(p),i.includes(p.categoria)||i.push(p.categoria)}return[new vis.DataSet(a),new vis.DataSet(e),i,o]}function crearNetwork(t,a){let e={nodes:t,edges:a},i={nodes:{shape:"box"},layout:{hierarchical:{enabled:!0,direction:"LR",levelSeparation:150}},edges:{arrows:{to:{enabled:!0,scaleFactor:.7,type:"arrow"}}},groups:{Aprobadas:{color:"#7BE141"},"En Final":{color:"#4ae9c1"},Habilitadas:{color:"#ffa500"},"Materias Electivas":{color:"#FA8072"},"Materias Obligatorias":{color:"#ADD8E6"},"Orientación: Gestión Industrial de Sistemas":{color:"#FFFF00"},"Orientación: Sistemas Distribuidos":{color:"#7FFFD4"},"Orientación: Sistemas de Producción":{color:"#6495ED"},"Orientación: Diseño Mecánico":{color:"#FFFF00"},"Orientación: Termomecánica":{color:"#7FFFD4"},"Orientación: Metalúrgica":{color:"#6495ED"},"Orientación: Computación Aplicada":{color:"#FFFFE0"},"Orientación: Industrias":{color:"#CCCCB3"},"Orientación: Multiples Orientaciones":{color:"#FFFF00"},"Orientación: Procesamiento de Señales":{color:"#7FFFD4"},"Orientación: Automatización y Control":{color:"#6495ED"},"Orientación: Física Electrónica":{color:"#FFFFE0"},"Orientación: Telecomunicaciones":{color:"#CCCCB3"},"Orientación: Sistemas Digitales y Computación":{color:"#FFE4E1"},"Orientación: Multimedia":{color:"#FFDAB9"},"Orientación: Instrumentación Biomédica":{color:"#66CDAA"}}};return new vis.Network($("#grafo")[0],e,i)}function Grupo(t){this.id=t,this.openOrClose=function(){FIUBAMAP.NETWORK.isCluster("cluster-"+this.id)?FIUBAMAP.NETWORK.openCluster("cluster-"+this.id):FIUBAMAP.NETWORK.cluster(crearClusterDeCategoria(this.id))}}function crearGrupo(t){if(t.includes("Electivas")||t.includes("Orientación")){let a=crearClusterDeCategoria(t);if(FIUBAMAP.NETWORK.cluster(a),t.includes("Orientación")){let[,a]=t.split(":");$("#orientaciones").append("<a class='toggle' id='toggle-"+t+"'>"+a+"</a>")}}}function crearClusterDeCategoria(t){return{joinCondition:function(a){return a.categoria===t},clusterNodeProperties:{id:"cluster-"+t,hidden:!0,level:20,allowSingleNodeCluster:!0}}}function Materia(t,a,e,i,o,n){this.id=t,this.label=breakWords(a),this.creditos=parseInt(e),this.correlativas=i.split("-"),this.group=o,this.level=n,this.categoria=o,this.aprobada=!1,this.nota=null,this.enfinal=!1,this.habilitada=!1,this.nodo=this,this.aprobar=function(){if(!this.nodo)return;this.nodo.aprobada=!0,this.actualizar(),FIUBAMAP.actualizarCreditos(this.nodo.creditos);let t=FIUBAMAP.NETWORK.getConnectedNodes(this.id,"to");t.forEach(t=>{let a=FIUBAMAP.MATERIAS.get(t);a&&a.habilitar()})},this.habilitar=function(){if(!this.nodo)return;let t=FIUBAMAP.NETWORK.getConnectedNodes(this.id,"from"),a=!0;for(let e=0;e<t.length;e++){let i=FIUBAMAP.MATERIAS.get(t[e]);i&&(a&=i.aprobada)}!a||FIUBAMAP.creditos<this.nodo.requiere||(this.nodo.habilitada=!0,this.actualizar())},this.ponerEnFinal=function(){this.nodo&&(this.desaprobar(),this.nodo.enfinal=!0,this.actualizar())},this.aprobarConNota=function(t){this.nodo&&(this.nodo.nota=t,this.nodo.label.includes("[")&&(this.nodo.label=this.nodo.label.split("\n[")[0]),this.nodo.label+="\n["+this.nodo.nota+"]",FIUBAMAP.actualizarPromedio(this.nodo),this.nodo.aprobada||this.aprobar())},this.deshabilitar=function(){this.nodo&&(this.nodo.habilitada=!1,this.actualizar())},this.desaprobar=function(){if(!this.nodo)return;this.nodo.aprobada&&FIUBAMAP.actualizarCreditos(-this.nodo.creditos),this.nodo.aprobada=!1,this.nodo.nota=0,this.nodo.label.includes("[")&&(this.nodo.label=this.nodo.label.split("\n[")[0]),FIUBAMAP.actualizarPromedio(this.nodo),this.nodo.enfinal=!1;let t=FIUBAMAP.NETWORK.getConnectedNodes(this.id,"to");t.forEach(t=>{let a=FIUBAMAP.MATERIAS.get(t);a&&a.deshabilitar()}),this.actualizar()},this.actualizar=function(){if(!this.nodo)return;let t=this.nodo.categoria;this.nodo.aprobada?t="Aprobadas":this.nodo.enfinal?t="En Final":this.nodo.habilitada&&(t="Habilitadas"),this.nodo.group=t,FIUBAMAP.MATERIAS.update(this.nodo)},this.mostrarOpciones=function(){if(!this.nodo)return;const t=this;let a=t.nodo.nota?t.nodo.nota:"",e='\n        <div class="modal" style=\'display:block\'>\n            <div id=\'materia-modal-content\' class="modal-content">\n                <span onclick=\'$(this.parentElement.parentElement.parentElement).empty()\' id="materiaclose-button" class="close-button">&times;</span>\n                <h3>['+t.id+"] "+t.nodo.label+'</h3>\n                <p>\n                    Nota:\n                    <input id=\'nota\' class=\'materia-input\' type="number" min="4" max="10" value="'+a+"\" />\n                </p>\n                <div id='materia-botones'>\n                    <button id='enfinal-button'>En Final</button>\n                    <button id='desaprobar-button'>Desaprobar</button>\n                    <button id='aprobar-button'>Aprobar</button>\n                </div>\n            </div>\n        </div>\n        ";$("#materia-modal").append($(e)),$("#aprobar-button").on("click",function(){let a=$("#nota").val();a?t.aprobarConNota(a):t.aprobar(),$("#materiaclose-button").click()}),$("#enfinal-button").on("click",function(){t.ponerEnFinal(),$("#materiaclose-button").click()}),$("#desaprobar-button").on("click",function(){t.desaprobar(),$("#materiaclose-button").click()})}}function breakWords(t){let a="";return t.split(" ").forEach(t=>{t.length<5?a+=" "+t:a+="\n"+t}),a.trim()}function save(t,a,e){let i=$("<form id='formRecord' type='hidden' action="+FORMAPI+" onsubmit='return window.submitGoogleForm(this)'></form>");i.append("<input name='entry.774465991' value="+t+">"),i.append("<input name='entry.992084860' value="+a+">"),i.append("<input name='entry.2026137499' value="+e+">"),i.submit()}function loadFromClave(t){$.ajax({url:SHEETAPI,method:"GET",success:function(a){loadMap(a,t)}})}function loadMap(t,a){$("#clave").val(a);let e=t.feed.entry,i=null;if(e.forEach(t=>{t.gsx$clave.$t==a&&(i=t)}),!i)return warning(a),void $("#sistemas").click();let o=i.gsx$carrera.$t,n=i.gsx$materias.$t,r=n.split("-");main(o,r)}function warning(t){let a='\n        <small><div class="alert">\n            <span class="close-button" onclick="this.parentElement.style.display=\'none\';">&times;</span> \n            <p><strong>Padrón no registrado!</strong> Seleccioná tu carrera, marca las materias que aprobaste y toca el boton de guardar.</p>\n            <p>Una vez guardado, podés entrar a <a href=https://fdelmazo.github.io/FIUBA-Map/?clave='+t+">https://fdelmazo.github.io/FIUBA-Map/?clave="+t+"</a> y ver tu progreso.</p>\n        </div></small>\n    ";$("#warning").append($(a))}function aprobarMateriasFromLoad(t){t.forEach(t=>{if(t.includes("*")){let[,a]=t.split("*");"F"==a?FIUBAMAP.MATERIAS.get(t).ponerEnFinal():FIUBAMAP.MATERIAS.get(t).aprobarConNota(a)}else FIUBAMAP.MATERIAS.get(t).aprobar()})}function main(t,a){let e,i,o,n,r;switch($(".dropdown-content").hide(),$("#grafo").html("<div class='loader'></div>"),t){case"informatica":n=!0,e="data/informatica-1986.csv",r="Plan 1986 v2016",i="Ingeniería en Informática",o="Informática";break;case"sistemas":n=!1,e="data/sistemas-1986.csv",r="Plan 1986 v2016",i="Licenciatura en Análisis de Sistemas",o="Sistemas";break;case"electronica":n=!0,e="data/electronica-2009.csv",r="Plan 2009 v2019",i="Ingeniería Electrónica",o="Electrónica";break;case"quimica":n=!1,e="data/quimica-1986.csv",r="Plan 1986 v2016",i="Ingeniería Química",o="Química";break;case"civil":n=!1,e="data/civil-2009.csv",r="Plan 2009 v2016",i="Ingeniería Civil",o="Civil";break;case"alimentos":n=!1,e="data/alimentos-2000.csv",r="Plan 2000 v2016",i="Ingeniería de Alimentos",o="Alimentos";break;case"electricista":n=!1,e="data/electricista-2009.csv",r="Plan 2009 v2016",i="Ingeniería Electricista",o="Electricista";break;case"naval":n=!1,e="data/naval-1986.csv",r="Plan 1986 v2016",i="Ingeniería Naval y Mecánica",o="Naval";break;case"mecanica":n=!0,e="data/mecanica-1986.csv",r="Plan 1986 v2016",i="Ingeniería Mecánica",o="Mecánica";break;case"petroleo":n=!1,e="data/petroleo-2015.csv",r="Plan 2015 v2016",i="Ingeniería en Petróleo",o="Petróleo";break;case"agrimensura":n=!1,e="data/agrimensura-2006.csv",r="Plan 2006 v2016",i="Ingeniería en Argimensura",o="Agrimensura";break;case"industrial":n=!1,e="data/industrial-2011.csv",r="Plan 2011 v2019",i="Ingeniería Industrial",o="Industrial"}$("#carrera-actual-long").text(i+" | "+r),$("#carrera-actual-short").text(o),$("#carreras .active").removeClass("active"),$("#"+t).addClass("active"),$("#orientaciones a").remove(),n?$("#orientaciones-hidden").show():$("#orientaciones-hidden").hide(),createFiubaMap(t,e,a)}function partyMode(t){t.hidden=!0,FIUBAMAP.MATERIAS.update(t);let a=fibonacciCounter();for(let t=0;t<a;t++){let t=document.createElement("IMG");t.setAttribute("src","https://cultofthepartyparrot.com/parrots/hd/parrot.gif"),t.setAttribute("class","party"),document.body.appendChild(t);let a=getRandomPosition(t);t.style.top=a[0]+"px",t.style.left=a[1]+"px"}}function getRandomPosition(t){let a=document.body.offsetHeight-t.clientHeight,e=document.body.offsetWidth-t.clientWidth,i=Math.floor(Math.random()*a),o=Math.floor(Math.random()*e);return[i,o]}function fibonacciCounter(){let t=FIBONACCIFIRST+FIBONACCISECOND;return FIBONACCIFIRST=FIBONACCISECOND,FIBONACCISECOND=t,FIBONACCIFIRST+FIBONACCISECOND}let FORMAPI="https://docs.google.com/forms/u/0/d/1xUf-9SWdGf0jv_weLRe4tlXb-GWHkH-kc-v_S8kKGCI",SHEETAPI="https://spreadsheets.google.com/feeds/list/1B7ytzx_-XvmaMApIb1UX3DXBCSCAAelXs_TuJ0Ww2fE/default/public/values?alt=json";$(document).ready(function(){$("#dbsave-button").on("click",function(){let t=$("#clave").val();if(!t)return;if("party"==t.toLowerCase())return void(PARTYMODE=!0);let a=FIUBAMAP.carrera,e=[];FIUBAMAP.MATERIAS.forEach(t=>{(t.aprobada||t.enfinal)&&(t.enfinal?e.push(t.id+"*F"):t.nota?e.push(t.id+"*"+t.nota):e.push(t.id))});let i=e.join("-");save(t,a,i),setTimeout(function(){window.location="https://fdelmazo.github.io/FIUBA-Map?clave="+t},1e3)}),$("#dbload-button").on("click",function(){let t=$("#clave").val();t&&("party"!=t.toLowerCase()?window.location="https://fdelmazo.github.io/FIUBA-Map?clave="+t:PARTYMODE=!0)}),$("#clave").on("keyup",function(t){13===t.keyCode&&(t.preventDefault(),$("#dbload-button").click())})}),function(t){function a(t){try{const a=[].slice.call(t).map(function(t){return"value"in t&&t.name?t.name+"="+(void 0===t.value?"":t.value):""}).join("&"),e=new XMLHttpRequest;e.open("POST",t.action+"/formResponse",!0),e.setRequestHeader("Accept","application/xml, text/xml, */*; q=0.01"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),e.send(a)}catch(t){}return t.parentNode.className+=" submitted",!1}t.submitGoogleForm=a}("undefined"==typeof module?window:module.exports),FIUBAMAP=null,$(document).ready(function(){$(".dropdown").on("mouseover",function(){$(this).children(".dropdown-content").show()}),$(".dropdown").on("mouseout",function(){$(this).children(".dropdown-content").hide()}),$(".carrera").on("click",function(){main($(this).attr("id"))}),$(document).keydown(function(t){27==t.keyCode&&$(".close-button").click()})}),$(document).ready(function(){let t=new URL(window.location.href);t.searchParams.get("clave")?loadFromClave(t.searchParams.get("clave")):$("#sistemas").click()}),PARTYMODE=!1;let FIBONACCIFIRST=0,FIBONACCISECOND=1;