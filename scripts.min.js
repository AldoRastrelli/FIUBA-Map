function Carrera(id,titulo,tituloShort,plan,filename,orientaciones){this.id=id;initCarrera(id,titulo,tituloShort,plan,orientaciones)}function initCarrera(id,titulo,tituloShort,plan,orientaciones){$("#carrera-actual-long").text(titulo+" | "+plan);$("#carrera-actual-short").text(tituloShort);$("#carreras .active").removeClass("active");$("#"+id).addClass("active");$("#orientaciones a").remove();if(orientaciones)$("#orientaciones-hidden").show();else $("#orientaciones-hidden").hide()}let FORMAPI="https://docs.google.com/forms/u/0/d/1xUf-9SWdGf0jv_weLRe4tlXb-GWHkH-kc-v_S8kKGCI";let SHEETAPI="https://spreadsheets.google.com/feeds/list/1B7ytzx_-XvmaMApIb1UX3DXBCSCAAelXs_TuJ0Ww2fE/default/public/values?alt=json";function save(clave,carrera,materias){let form=$("<form id='formRecord' type='hidden' action="+FORMAPI+" onsubmit='return window.submitGoogleForm(this)'></form>");form.append("<input name='entry.774465991' value="+clave+">");form.append("<input name='entry.992084860' value="+carrera+">");form.append("<input name='entry.2026137499' value="+materias+">");form.submit()}function loadFromClave(clave){$.ajax({url:SHEETAPI,method:"GET",success:function(data){loadMap(data,clave)}})}function loadMap(api,clave){$("#clave").val(clave);let data=api.feed.entry;let usuario=null;data.forEach(fila=>{if(fila.gsx$clave.$t==clave)usuario=fila});if(!usuario){warning(clave);$("#sistemas").click();return}let carrera=usuario.gsx$carrera.$t;let materias=usuario.gsx$materias.$t;let materiasAprobadas=materias.split("-");main(carrera,materiasAprobadas)}function warning(clave){let html=`\n        <small><div class="alert">\n            <span class="close-button" onclick="this.parentElement.style.display='none';">&times;</span> \n            <p><strong>Padrón no registrado!</strong> Seleccioná tu carrera, marca las materias que aprobaste y toca el boton de guardar.</p>\n            <p>Una vez guardado, podés entrar a <a href=https://fdelmazo.github.io/FIUBA-Map/?clave=`+clave+`>https://fdelmazo.github.io/FIUBA-Map/?clave=`+clave+`</a> y ver tu progreso.</p>\n        </div></small>\n    `;$("#warning").append($(html))}$(document).ready(function(){$("#dbsave-button").on("click",function(){let clave=$("#clave").val();if(!clave)return;if(clave.toLowerCase()=="party"){PARTYMODE=true;return}let carrera=CARRERA_ACTUAL.id;let materiasArr=[];NODOS.forEach(nodo=>{if(nodo.aprobada||nodo.enfinal){if(nodo.enfinal)materiasArr.push(nodo.id+"*F");else if(nodo.nota)materiasArr.push(nodo.id+"*"+nodo.nota);else materiasArr.push(nodo.id)}});let materias=materiasArr.join("-");save(clave,carrera,materias);setTimeout(function(){window.location="https://fdelmazo.github.io/FIUBA-Map?clave="+clave},1e3)});$("#dbload-button").on("click",function(){let clave=$("#clave").val();if(!clave)return;if(clave.toLowerCase()=="party"){PARTYMODE=true;return}window.location="https://fdelmazo.github.io/FIUBA-Map?clave="+clave});$("#clave").on("keyup",function(event){if(event.keyCode===13){event.preventDefault();$("#dbload-button").click()}})});function createFiubaMap(file,materiasFromLoad){$.ajax({url:file,dataType:"text",success:function(data){FiubaMap(data,materiasFromLoad)}})}function FiubaMap(data,materiasFromLoad){[NODOS,ARISTAS,GRUPOS,NODOS_CRED]=csvANodosyAristas(data);NETWORK=crearNetwork(NODOS,ARISTAS);if(materiasFromLoad){materiasFromLoad.forEach(m=>{if(m.includes("*")){let[materia,nota]=m.split("*");if(nota=="F")new Materia(m).ponerEnFinal();else new Materia(m).aprobarConNota(nota)}else new Materia(m).aprobar()})}else{new Materia("CBC").aprobar()}GRUPOS.forEach(g=>{if(g.includes("Electivas")||g.includes("Orientación")){let cluster=crearClusterDeCategoria(g);NETWORK.cluster(cluster);if(g.includes("Orientación")){let[_,orientacion]=g.split(":");$("#orientaciones").append("<a class='toggle' id='toggle-"+g+"'>"+orientacion+"</a>")}}});resetBindings()}function csvANodosyAristas(data){let nodos=[];let aristas=[];let grupos=[];let nodosCred=[];let filas=data.split(/\r?\n|\r/);for(let fila=1;fila<filas.length;fila++){let rowCells=filas[fila].split(",");let materia=createMateria(rowCells);materia.correlativas.forEach(c=>{if(c.includes("CRED")){let[_,n]=c.split("CRED");materia.requiere=n;nodosCred.push(materia)}let edge={from:c,to:materia.id};if(c=="CBC"&&materia.requiere)edge.hidden=true;aristas.push(edge)});nodos.push(materia);if(!grupos.includes(rowCells[4]))grupos.push(rowCells[4])}return[new vis.DataSet(nodos),new vis.DataSet(aristas),grupos,nodosCred]}function crearNetwork(nodes,edges){let data={nodes:nodes,edges:edges};let options={nodes:{shape:"box"},layout:{hierarchical:{enabled:true,direction:"LR",levelSeparation:150}},edges:{arrows:{to:{enabled:true,scaleFactor:.7,type:"arrow"}}},groups:{Aprobadas:{color:"#7BE141"},"En Final":{color:"#4ae9c1"},Habilitadas:{color:"#ffa500"},"Materias Electivas":{color:"#FA8072"},"Materias Obligatorias":{color:"#ADD8E6"},"Orientación: Gestión Industrial de Sistemas":{color:"#FFFF00"},"Orientación: Sistemas Distribuidos":{color:"#7FFFD4"},"Orientación: Sistemas de Producción":{color:"#6495ED"},"Orientación: Diseño Mecánico":{color:"#FFFF00"},"Orientación: Termomecánica":{color:"#7FFFD4"},"Orientación: Metalúrgica":{color:"#6495ED"},"Orientación: Computación Aplicada":{color:"#FFFFE0"},"Orientación: Industrias":{color:"#CCCCB3"},"Orientación: Multiples Orientaciones":{color:"#FFFF00"},"Orientación: Procesamiento de Señales":{color:"#7FFFD4"},"Orientación: Automatización y Control":{color:"#6495ED"},"Orientación: Física Electrónica":{color:"#FFFFE0"},"Orientación: Telecomunicaciones":{color:"#CCCCB3"},"Orientación: Sistemas Digitales y Computación":{color:"#FFE4E1"},"Orientación: Multimedia":{color:"#FFDAB9"},"Orientación: Instrumentación Biomédica":{color:"#66CDAA"}}};let network=new vis.Network($("#grafo")[0],data,options);network.creditos=0;$("#creditos-var").text(0);$("#promedio-var").text("-");network.aprobadasConNota={};return network}function actualizarPromedio(nodo){if(nodo.nota==0)delete NETWORK.aprobadasConNota[nodo.id];else NETWORK.aprobadasConNota[nodo.id]=parseInt(nodo.nota);let sumatoria=Object.values(NETWORK.aprobadasConNota).reduce((a,b)=>a+b,0);let aprobadas=Object.values(NETWORK.aprobadasConNota).length;let promedio=(sumatoria/aprobadas).toFixed(2);if(!isNaN(promedio))$("#promedio-var").text(promedio);else $("#promedio-var").text("-")}function actualizarCreditos(numero){NETWORK.creditos+=numero;$("#creditos-var").text(NETWORK.creditos)}function crearClusterDeCategoria(grupo){return cluster={joinCondition:function(nodeOptions){return nodeOptions.categoria===grupo},clusterNodeProperties:{id:"cluster-"+grupo,hidden:true,level:20,allowSingleNodeCluster:true}}}function resetBindings(){$(".toggle").off("click").on("click",function(){let[_,grupo]=$(this).attr("id").split("-");if(NETWORK.isCluster("cluster-"+grupo))NETWORK.openCluster("cluster-"+grupo);else NETWORK.cluster(crearClusterDeCategoria(grupo));NETWORK.fit()});NETWORK.off("click").on("click",function(params){if(!params.event.isFinal)return;let id=params.nodes[0];if(!id)return;let nodo=NODOS.get(id);let aprobada=nodo.aprobada;if(!aprobada){if(PARTYMODE)partyMode(nodo);new Materia(id).aprobar()}else{new Materia(id).desaprobar()}});NETWORK.off("hold").on("hold",function(params){let id=params.nodes[0];new Materia(id).mostrarOpciones()})}!function(exports){exports.submitGoogleForm=submitGoogleForm;function submitGoogleForm(form){try{var data=[].slice.call(form).map(function(control){return"value"in control&&control.name?control.name+"="+(control.value===undefined?"":control.value):""}).join("&");var xhr=new XMLHttpRequest;xhr.open("POST",form.action+"/formResponse",true);xhr.setRequestHeader("Accept","application/xml, text/xml, */*; q=0.01");xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");xhr.send(data)}catch(e){}form.parentNode.className+=" submitted";return false}}(typeof module==="undefined"?window:module.exports);function main(carrera,materiasFromLoad){$(".dropdown-content").hide();$("#grafo").html("<div class='loader'></div>");let filename,titulo,tituloShort,orientaciones,plan;switch(carrera){case"informatica":orientaciones=true;filename="data/informatica-1986.csv";plan="Plan 1986 v2016";titulo="Ingeniería en Informática";tituloShort="Informática";break;case"sistemas":orientaciones=false;filename="data/sistemas-1986.csv";plan="Plan 1986 v2016";titulo="Licenciatura en Análisis de Sistemas";tituloShort="Sistemas";break;case"electronica":orientaciones=true;filename="data/electronica-2009.csv";plan="Plan 2009 v2019";titulo="Ingeniería Electrónica";tituloShort="Electrónica";break;case"quimica":orientaciones=false;filename="data/quimica-1986.csv";plan="Plan 1986 v2016";titulo="Ingeniería Química";tituloShort="Química";break;case"civil":orientaciones=false;filename="data/civil-2009.csv";plan="Plan 2009 v2016";titulo="Ingeniería Civil";tituloShort="Civil";break;case"alimentos":orientaciones=false;filename="data/alimentos-2000.csv";plan="Plan 2000 v2016";titulo="Ingeniería de Alimentos";tituloShort="Alimentos";break;case"electricista":orientaciones=false;filename="data/electricista-2009.csv";plan="Plan 2009 v2016";titulo="Ingeniería Electricista";tituloShort="Electricista";break;case"naval":orientaciones=false;filename="data/naval-1986.csv";plan="Plan 1986 v2016";titulo="Ingeniería Naval y Mecánica";tituloShort="Naval";break;case"mecanica":orientaciones=true;filename="data/mecanica-1986.csv";plan="Plan 1986 v2016";titulo="Ingeniería Mecánica";tituloShort="Mecánica";break;case"petroleo":orientaciones=false;filename="data/petroleo-2015.csv";plan="Plan 2015 v2016";titulo="Ingeniería en Petróleo";tituloShort="Petróleo";break;case"agrimensura":orientaciones=false;filename="data/agrimensura-2006.csv";plan="Plan 2006 v2016";titulo="Ingeniería en Argimensura";tituloShort="Agrimensura";break;case"industrial":orientaciones=false;filename="data/industrial-2011.csv";plan="Plan 2011 v2019";titulo="Ingeniería Industrial";tituloShort="Industrial";break}CARRERA_ACTUAL=new Carrera(carrera,titulo,tituloShort,plan,filename,orientaciones);createFiubaMap(filename,materiasFromLoad)}$(document).ready(function(){$(".dropdown").on("mouseover",function(){$(this).children(".dropdown-content").show()});$(".dropdown").on("mouseout",function(){$(this).children(".dropdown-content").hide()});$(".carrera").on("click",function(){main($(this).attr("id"))});$(document).keydown(function(event){if(event.keyCode==27)$(".close-button").click()})});$(document).ready(function(){let url=new URL(window.location.href);if(url.searchParams.get("clave"))loadFromClave(url.searchParams.get("clave"));else $("#sistemas").click()});function Materia(codigo){this.id=codigo;this.nodo=NODOS.get(this.id);this.aprobar=function(){if(!this.nodo)return;this.nodo.aprobada=true;this.actualizarGrupo();actualizarCreditos(this.nodo.creditos);let materiasQueHabilita=NETWORK.getConnectedNodes(this.id,"to");materiasQueHabilita.forEach(m=>{new Materia(m).habilitar()})};this.habilitar=function(){if(!this.nodo)return;let neighborsFrom=NETWORK.getConnectedNodes(this.id,"from");let todoAprobado=true;for(let i=0;i<neighborsFrom.length;i++){let correlativa=NODOS.get(neighborsFrom[i]);if(!correlativa)continue;todoAprobado&=correlativa.aprobada}if(!todoAprobado||NETWORK.creditos<this.nodo.requiere)return;this.nodo.habilitada=true;this.actualizarGrupo()};this.ponerEnFinal=function(){if(!this.nodo)return;this.desaprobar();this.nodo.enfinal=true;this.actualizarGrupo()};this.aprobarConNota=function(nota){if(!this.nodo)return;if(nota){this.nodo.nota=nota;if(this.nodo.label.includes("["))this.nodo.label=this.nodo.label.split("\n[")[0];this.nodo.label+="\n["+this.nodo.nota+"]";actualizarPromedio(this.nodo)}if(!this.nodo.aprobada)this.aprobar()};this.deshabilitar=function(){if(!this.nodo)return;this.nodo.habilitada=false;this.actualizarGrupo()};this.desaprobar=function(){if(!this.nodo)return;if(this.nodo.aprobada)actualizarCreditos(-this.nodo.creditos);this.nodo.aprobada=false;this.nodo.nota=0;if(this.nodo.label.includes("["))this.nodo.label=this.nodo.label.split("\n[")[0];actualizarPromedio(this.nodo);this.nodo.enfinal=false;let materiasQueHabilita=NETWORK.getConnectedNodes(this.id,"to");materiasQueHabilita.forEach(m=>{new Materia(m).deshabilitar()});this.actualizarGrupo()};this.mostrarOpciones=function(){if(!this.nodo)return;var self=this;let nodonota=self.nodo.nota?self.nodo.nota:"";let html=`\n        <div class="modal" style='display:block'>\n            <div id='materia-modal-content' class="modal-content">\n                <span onclick='$(this.parentElement.parentElement.parentElement).empty()' id="materiaclose-button" class="close-button">&times;</span>\n                <h3>[`+self.id+`] `+self.nodo.label+`</h3>\n                <p>\n                    Nota:\n                    <input id='nota' class='materia-input' type="number" min="4" max="10" value="`+nodonota+`" />\n                </p>\n                <div id='materia-botones'>\n                    <button id='enfinal-button'>En Final</button>\n                    <button id='desaprobar-button'>Desaprobar</button>\n                    <button id='aprobar-button'>Aprobar</button>\n                </div>\n            </div>\n        </div>\n        `;$("#materia-modal").append($(html));$("#aprobar-button").on("click",function(){let nota=$("#nota").val();self.aprobarConNota(nota);$("#materiaclose-button").click()});$("#enfinal-button").on("click",function(){self.ponerEnFinal();$("#materiaclose-button").click()});$("#desaprobar-button").on("click",function(){self.desaprobar();$("#materiaclose-button").click()})};this.actualizarGrupo=function(){if(!this.nodo)return;let grupoDefault=this.nodo.categoria;if(this.nodo.aprobada)grupoDefault="Aprobadas";else if(this.nodo.enfinal)grupoDefault="En Final";else if(this.nodo.habilitada)grupoDefault="Habilitadas";this.nodo.group=grupoDefault;NODOS.update(this.nodo)}}function createMateria(rowCells){let[codigo,materia,creditos,correlativas,categoria,nivel]=rowCells;let m={};m.label=breakWords(materia);m.creditos=parseInt(creditos);m.correlativas=correlativas.split("-");m.id=codigo;m.group=categoria;m.level=nivel;m.categoria=categoria;m.aprobada=false;m.nota=null;m.enfinal=false;m.habilitada=false;return m}function breakWords(string){let broken="";string.split(" ").forEach(element=>{if(element.length<5)broken+=" "+element;else broken+="\n"+element});return broken.trim()}PARTYMODE=false;FIBONACCIFIRST=0;FIBONACCISECOND=1;function partyMode(nodo){nodo.hidden=true;NODOS.update(nodo);let counter=fibonacciCounter();for(let i=0;i<counter;i++){let img=document.createElement("IMG");img.setAttribute("src","https://cultofthepartyparrot.com/parrots/hd/parrot.gif");img.setAttribute("class","party");document.body.appendChild(img);let xy=getRandomPosition(img);img.style.top=xy[0]+"px";img.style.left=xy[1]+"px"}}function getRandomPosition(element){let x=document.body.offsetHeight-element.clientHeight;let y=document.body.offsetWidth-element.clientWidth;let randomX=Math.floor(Math.random()*x);let randomY=Math.floor(Math.random()*y);return[randomX,randomY]}function fibonacciCounter(){let val=FIBONACCIFIRST+FIBONACCISECOND;FIBONACCIFIRST=FIBONACCISECOND;FIBONACCISECOND=val;return FIBONACCIFIRST+FIBONACCISECOND}